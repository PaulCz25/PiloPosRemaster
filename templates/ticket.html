<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Ticket {{ venta.id }}</title>
  <style>
    :root{
      --paper: 58mm;           /* cámbialo a 80mm si tu rollo es de 80 */
      --edge: 3mm;             /* margen seguro */
      --safe: calc(var(--paper) - (var(--edge)*2));
      --fs-base: 11px;
      --fs-small: 10px;
      --rule: 1px;
      --gap: 4px;
    }

    @page { size: var(--paper) auto; margin: 0; }
    html, body { margin:0; padding:0; }
    body{
      width: var(--safe);
      margin: 0 auto;
      font-family: Arial, sans-serif;
      font-size: var(--fs-base);
      line-height: 1.2;
      color:#000;
      font-variant-numeric: tabular-nums;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    .tkt{ padding:4px; }
    .center{text-align:center;}
    .right{text-align:right;}
    .bold{font-weight:700;}
    .small{font-size:var(--fs-small);}
    .rule{border:0;border-top:var(--rule) solid #000;margin:var(--gap) 0;}

    /* Items */
    .items{width:100%;}
    .thead,.row{
      display:grid;
      grid-template-columns: 1fr 2.5ch 7ch; /* nombre | cant | importe */
      gap:4px;
    }
    .thead{font-weight:700;border-bottom:1px solid #000;padding-bottom:1px;margin-bottom:2px;}
    .qty,.amt{text-align:right;}
    .name{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}

    /* Totales */
    .totals{margin-top:2px;}
    .tot-row{display:grid;grid-template-columns:1fr 7ch;}
    .tot-row div:last-child{text-align:right;}
    .grand{font-weight:800;font-size:12px;border-top:1px solid #000;margin-top:2px;padding-top:2px;}
  </style>
</head>
<body>
  <div class="tkt">
    <div class="center bold">{{ negocio.nombre }}</div>
    {% if negocio.direccion %}<div class="center small">{{ negocio.direccion }}</div>{% endif %}
    {% if negocio.telefono %}<div class="center small">Tel: {{ negocio.telefono }}</div>{% endif %}

    <hr class="rule">

    <div class="small">
      Folio: <span class="bold">#{{ venta.id }}</span><br>
      {{ venta.fecha }}{% if venta.hora %} {{ venta.hora }}{% endif %}
    </div>

    <hr class="rule">

    <div class="items">
      <div class="thead small">
        <div>Prod</div><div class="qty">C</div><div class="amt">Imp</div>
      </div>
      {% for it in lineas %}
      <div class="row">
        <div class="name">{{ it.nombre }}</div>
        <div class="qty">{{ it.cantidad }}</div>
        <div class="amt">${{ '%.2f' % it.importe }}</div>
      </div>
      {% endfor %}
    </div>

    <hr class="rule">

    <div class="totals small">
      <div class="tot-row"><div>Subtotal</div><div>${{ '%.2f' % subtotal }}</div></div>
      {% if descuento and descuento != 0 %}
      <div class="tot-row"><div>Desc</div><div>-{{ '%.2f' % descuento }}</div></div>
      {% endif %}
      {% if redondeo and redondeo != 0 %}
      <div class="tot-row"><div>Redondeo</div><div>{{ '%.2f' % redondeo }}</div></div>
      {% endif %}
      <div class="tot-row grand"><div>Total</div><div>${{ '%.2f' % venta.total }}</div></div>
    </div>

    <hr class="rule">

    <div class="center small">¡Gracias por su compra!</div>
  </div>
</body>
</html>
